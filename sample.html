<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="wrapper">
      <h1 style='color:white;'>Staggered orders overview</h1>
      <h2>A mountain based visualisation of (base asset/quote asset)</h2>
      <canvas id="myChart" width="1600" height="900"></canvas>
    </div>
    <div id="response-container"></div>
    <script>
    function showChart() {
      window.pywebview.api.getData().then(
            function(result) {
              drawChart(result.price,result.mountain,result.current,result.title);
            }
          )};

    function drawChart(x, y, z, w) {
        var ctx = document.getElementById("myChart");
        ctx.style.backgroundColor = 'rgb(21,43,42)';
        var barBackgroundColors1 = []; // initial
        var barBackgroundColors2 = []; // profit
        var myChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: x,
            datasets: [
              {
                label: 'Initial',
                data: y,
                backgroundColor: barBackgroundColors1 //"rgba(58, 98, 87, 0.5)"
              }, {
                label: 'Profit',
                data: z,
                backgroundColor: barBackgroundColors2 //"rgba(51, 204, 51, 0.9)"
              }
            ]
          },
          options: {
            legend: {
              display: false
            },
            scales: {
                xAxes: [{
                    gridLines: {
                      display: false
                    },
                    stacked: true,
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: w,
                        fontSize: 16,
                        fontColor: 'white'
                    },
                    ticks: {
                      fontColor: 'white'
                    }
                }],
                yAxes: [{
                    gridLines: {
                      color: 'rgba(153,153,153,0.2)'
                    },
                    stacked: true,
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: "Order size",
                        fontSize: 16,
                        fontColor: 'white'
                    },
                    ticks: {
                      fontColor: 'white'
                    }
                }]
             },
            tooltips: {
                displayColors: false,
                callbacks: {
                    title: function(tooltipItem) {
                      return `${w}: ${String(tooltipItem[0].xLabel)}`; // ESS syntax
                    },
                    label: function(tooltipItemY) {
                        return "Total: " + `${Number(tooltipItemY.yLabel)}`;
                    }
                }
              }
            }
        })

        for (i = 0; i < x.length; i++) {
            if (x[i] > 1) {
                barBackgroundColors1.push('rgb(230, 0, 0, 0.5)');
                barBackgroundColors2.push('rgb(255, 0, 0, 0.9)');
            }

            else {
              if (x[i] == 1) {
                barBackgroundColors1.push('rgb(217, 217, 217, 0.5)');
                barBackgroundColors2.push('rgb(242, 242, 242, 0.9)');
              }
              else {
                barBackgroundColors1.push('rgba(58, 98, 87, 0.5)');
                barBackgroundColors2.push('rgba(51, 204, 51, 0.9)');
              }
            }
        }

        myChart.update();
    };

    </script>
  </body>
</html>
